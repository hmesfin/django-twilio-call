[tox]
envlist =
    py{38,39,310,311,312}-django{42,50,51}
    ruff
    mypy
    coverage
skipsdist = false

[testenv]
deps =
    django42: Django>=4.2,<5.0
    django50: Django>=5.0,<5.1
    django51: Django>=5.1,<5.2
    djangorestframework>=3.14.0
    pytest>=7.4.0
    pytest-django>=4.5.0
    pytest-cov>=4.1.0
    pytest-asyncio>=0.21.0
    factory-boy>=3.3.0
    faker>=18.0.0
    responses>=0.23.0
    redis>=4.5.0
    celery>=5.3.0
    twilio>=8.0.0
commands =
    pytest {posargs}

[testenv:ruff]
deps =
    ruff>=0.1.0
commands =
    ruff check django_twilio_call tests
    ruff format --check django_twilio_call tests

[testenv:mypy]
deps =
    mypy>=1.0.0
    django-stubs>=4.2.0
    djangorestframework-stubs>=3.14.0
    types-redis
    types-pytz
    types-python-dateutil
commands =
    mypy django_twilio_call

[testenv:coverage]
deps =
    {[testenv]deps}
    coverage[toml]>=7.0
commands =
    coverage erase
    coverage run -m pytest
    coverage report
    coverage html
    coverage xml

[testenv:docs]
deps =
    sphinx>=6.0.0
    sphinx-rtd-theme>=1.3.0
    sphinxcontrib-django>=2.5
    myst-parser>=2.0.0
changedir = docs
commands =
    sphinx-build -W -b html -d {envtmpdir}/doctrees . {envtmpdir}/html

[testenv:safety]
deps =
    safety>=2.3.0
commands =
    safety check --json

[testenv:bandit]
deps =
    bandit[toml]>=1.7.0
commands =
    bandit -r django_twilio_call -ll

[testenv:build]
deps =
    build>=0.10.0
    twine>=4.0.0
commands =
    python -m build
    twine check dist/*

[gh-actions]
python =
    3.8: py38
    3.9: py39
    3.10: py310
    3.11: py311
    3.12: py312

[pytest]
DJANGO_SETTINGS_MODULE = tests.settings
python_files = tests.py test_*.py *_tests.py
addopts =
    --verbose
    --tb=short
    --strict-markers
    --cov=django_twilio_call
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
testpaths = tests